<div class="dashboard-content">
  @if (isLoading) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p class="mt-3">Carregando seus dados...</p>
    </div>
  } @else {
    <div class="my-profile" id="profile">
      <div class="profile-info">
        <!-- Profile Header Card -->
        <div class="common-card">
          <div class="user-name media">
            <div class="user-avatar-profile me-3">
              @if (userData?.photoURL) {
                <img [src]="userData?.photoURL" [alt]="userData?.name" class="avatar-img-large" />
              } @else {
                <div class="avatar-initials-large">{{ getUserInitials() }}</div>
              }
            </div>
            <div class="media-body">
              <h5>{{ userData?.name || 'Usuário' }}</h5>
              <div class="user-email-display">
                <app-feather-icons [icon]="'mail'" class="me-2" />
                <span>{{ userData?.email || 'Não informado' }}</span>
              </div>
            </div>
            @if (!isEditMode) {
              <button
                class="btn btn-gradient btn-pill color-2"
                (click)="toggleEditMode()"
              >
                <app-feather-icons [icon]="'edit-2'" class="me-2" />
                Editar Perfil
              </button>
            }
          </div>

          @if (userData?.bio) {
            <div class="user-bio mt-3">
              <p class="font-roboto">{{ userData?.bio }}</p>
            </div>
          }
        </div>

        <!-- View Mode -->
        @if (!isEditMode) {
          <div class="common-card">
            <div class="row">
              <div class="col-lg-12">
                <div class="information-detail">
                  <div class="common-header">
                    <h5>Informações Pessoais</h5>
                  </div>
                  <div class="information">
                    <ul>
                      <li>
                        <span>Nome Completo:</span>
                        <p>{{ userData?.name || 'Não informado' }}</p>
                      </li>
                      <li>
                        <span>Email:</span>
                        <p>{{ userData?.email || 'Não informado' }}</p>
                      </li>
                      <li>
                        <span>Telefone:</span>
                        <p>{{ userData?.phone || 'Não informado' }}</p>
                      </li>
                      <li>
                        <span>Data de Nascimento:</span>
                        <p>{{ formatDate(userData?.birthDate || '') }}</p>
                      </li>
                      <li>
                        <span>Gênero:</span>
                        <p>{{ userData?.gender || 'Não informado' }}</p>
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="information-detail">
                  <div class="common-header">
                    <h5>Endereço</h5>
                  </div>
                  <div class="information">
                    <ul>
                      <li>
                        <span>Endereço:</span>
                        <p>{{ userData?.address || 'Não informado' }}</p>
                      </li>
                      <li>
                        <span>Bairro:</span>
                        <p>{{ userData?.neighborhood || 'Não informado' }}</p>
                      </li>
                      <li>
                        <span>Cidade:</span>
                        <p>{{ userData?.city || 'Não informado' }}</p>
                      </li>
                      <li>
                        <span>Estado:</span>
                        <p>{{ userData?.state || 'Não informado' }}</p>
                      </li>
                      <li>
                        <span>CEP:</span>
                        <p>{{ userData?.zipCode || 'Não informado' }}</p>
                      </li>
                      <li>
                        <span>País:</span>
                        <p>{{ userData?.country || 'Brasil' }}</p>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        }

        <!-- Edit Mode -->
        @if (isEditMode) {
          <div class="common-card">
            <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
              <div class="row">
                <div class="col-lg-12">
                  <div class="information-detail">
                    <div class="common-header d-flex justify-content-between align-items-center">
                      <h5>Editar Informações Pessoais</h5>
                      <div class="btn-group">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          (click)="toggleEditMode()"
                          [disabled]="isSaving"
                        >
                          <app-feather-icons [icon]="'x'" class="me-2" />
                          Cancelar
                        </button>
                        <button
                          type="submit"
                          class="btn btn-gradient color-2"
                          [disabled]="isSaving || profileForm.invalid"
                        >
                          @if (isSaving) {
                            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                            Salvando...
                          } @else {
                            <app-feather-icons [icon]="'save'" class="me-2" />
                            Salvar Alterações
                          }
                        </button>
                      </div>
                    </div>

                    <div class="row mt-4">
                      <!-- Nome -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Nome Completo *</label>
                        <input
                          type="text"
                          class="form-control"
                          formControlName="name"
                          placeholder="Seu nome completo"
                          [class.is-invalid]="getFieldError('name')"
                        />
                        @if (getFieldError('name')) {
                          <div class="invalid-feedback">{{ getFieldError('name') }}</div>
                        }
                      </div>

                      <!-- Telefone -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Telefone</label>
                        <input
                          type="tel"
                          class="form-control"
                          formControlName="phone"
                          placeholder="(00) 00000-0000"
                        />
                      </div>

                      <!-- Data de Nascimento -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Data de Nascimento</label>
                        <input
                          type="date"
                          class="form-control"
                          formControlName="birthDate"
                        />
                      </div>

                      <!-- Gênero -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Gênero</label>
                        <select class="form-select" formControlName="gender">
                          <option value="">Selecione...</option>
                          <option value="Masculino">Masculino</option>
                          <option value="Feminino">Feminino</option>
                          <option value="Outro">Outro</option>
                          <option value="Prefiro não informar">Prefiro não informar</option>
                        </select>
                      </div>

                      <!-- Bio -->
                      <div class="col-12 mb-3">
                        <label class="form-label">Biografia</label>
                        <textarea
                          class="form-control"
                          formControlName="bio"
                          rows="3"
                          placeholder="Conte um pouco sobre você..."
                          maxlength="500"
                          [class.is-invalid]="getFieldError('bio')"
                        ></textarea>
                        <small class="text-muted">
                          {{ profileForm.get('bio')?.value?.length || 0 }}/500 caracteres
                        </small>
                        @if (getFieldError('bio')) {
                          <div class="invalid-feedback">{{ getFieldError('bio') }}</div>
                        }
                      </div>
                    </div>
                  </div>

                  <div class="information-detail">
                    <div class="common-header">
                      <h5>Endereço</h5>
                    </div>

                    <div class="row mt-4">
                      <!-- Endereço -->
                      <div class="col-md-8 mb-3">
                        <label class="form-label">Endereço</label>
                        <input
                          type="text"
                          class="form-control"
                          formControlName="address"
                          placeholder="Rua, Avenida, número"
                        />
                      </div>

                      <!-- CEP -->
                      <div class="col-md-4 mb-3">
                        <label class="form-label">CEP</label>
                        <input
                          type="text"
                          class="form-control"
                          formControlName="zipCode"
                          placeholder="00000-000"
                        />
                      </div>

                      <!-- Bairro -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Bairro</label>
                        <input
                          type="text"
                          class="form-control"
                          formControlName="neighborhood"
                          placeholder="Nome do bairro"
                        />
                      </div>

                      <!-- Cidade -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Cidade</label>
                        <input
                          type="text"
                          class="form-control"
                          formControlName="city"
                          placeholder="Nome da cidade"
                        />
                      </div>

                      <!-- Estado -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Estado</label>
                        <select class="form-select" formControlName="state">
                          <option value="">Selecione o estado...</option>
                          <option value="AC">Acre</option>
                          <option value="AL">Alagoas</option>
                          <option value="AP">Amapá</option>
                          <option value="AM">Amazonas</option>
                          <option value="BA">Bahia</option>
                          <option value="CE">Ceará</option>
                          <option value="DF">Distrito Federal</option>
                          <option value="ES">Espírito Santo</option>
                          <option value="GO">Goiás</option>
                          <option value="MA">Maranhão</option>
                          <option value="MT">Mato Grosso</option>
                          <option value="MS">Mato Grosso do Sul</option>
                          <option value="MG">Minas Gerais</option>
                          <option value="PA">Pará</option>
                          <option value="PB">Paraíba</option>
                          <option value="PR">Paraná</option>
                          <option value="PE">Pernambuco</option>
                          <option value="PI">Piauí</option>
                          <option value="RJ">Rio de Janeiro</option>
                          <option value="RN">Rio Grande do Norte</option>
                          <option value="RS">Rio Grande do Sul</option>
                          <option value="RO">Rondônia</option>
                          <option value="RR">Roraima</option>
                          <option value="SC">Santa Catarina</option>
                          <option value="SP">São Paulo</option>
                          <option value="SE">Sergipe</option>
                          <option value="TO">Tocantins</option>
                        </select>
                      </div>

                      <!-- País -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label">País</label>
                        <input
                          type="text"
                          class="form-control"
                          formControlName="country"
                          placeholder="País"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        }
      </div>
    </div>
  }
</div>
